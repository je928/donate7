<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="recruit">
	<!-- Use type aliases to avoid typing the full classname every time. -->
	<resultMap id="RecruitResult" type="recruit">
		<result property="vt_no" column="VT_NO" />
		<result property="vt_name" column="VT_NAME" />
		<result property="vt_o_no" column="VT_O_NO" />
		<result property="o_oname" column="O_ONAME" />
		<result property="vt_r_start_date" column="VT_R_START_DATE" />
		<result property="vt_r_end_date" column="VT_R_END_DATE" />
		<result property="vt_r_yn" column="VT_R_YN" />
		<result property="vt_a_start_date" column="VT_A_START_DATE" />
		<result property="vt_a_end_date" column="VT_A_END_DATE" />
		<result property="vt_class" column="VT_CLASS" />
		<result property="vt_tot" column="VT_TOT" />
		<result property="vt_subject" column="VT_SUBJECT" />
		<result property="vt_desc" column="VT_DESC" />
		<result property="count" column="COUNT" />
		<result property="class_name" column="CLASS_NAME" />
		<result property="dclass_name" column="DCLASS_NAME" />
		<result property="sub_name" column="SUB_NAME" />
	</resultMap>

	<select id="selectRcList" resultMap="RecruitResult"
		parameterType="recruit">
		SELECT * FROM (SELECT ROWNUM RN, A.* FROM (SELECT * FROM VT_RECRUIT
		<where>
			<if test="vt_o_no != 0">
				VT_O_NO = #{vt_o_no}
			</if>
			
			<if test="searchType != 'all'">
				<if test="vt_r_start_date != null">
					<![CDATA[ AND VT_R_START_DATE >= #{vt_r_start_date} ]]>
				</if>
				<if test="vt_r_end_date != null">
					<![CDATA[ AND VT_R_END_DATE <= #{vt_r_end_date} ]]>
				</if>
				<if test="vt_a_start_date != null">
					<![CDATA[ AND VT_A_START_DATE >= #{vt_a_start_date} ]]>
				</if>
				<if test="vt_a_end_date != null">
					<![CDATA[ AND VT_A_END_DATE <= #{vt_a_end_date} ]]>
				</if>
			</if>
			<if test="vt_name != null">
					<![CDATA[ AND VT_NAME LIKE '%'||#{vt_name}||'%' ]]>
			</if>
		</where>
		ORDER BY VT_NO DESC) A) WHERE RN BETWEEN #{startrow} AND #{endrow}
	</select>

	<select id="selectRcTotal" parameterType="recruit" resultType="int">
		SELECT NVL(COUNT(*),0) FROM VT_RECRUIT
		<where>
			<if test="vt_o_no != 0">
				VT_O_NO = #{vt_o_no}
			</if>
			<if test="searchType != null">
				<if test="vt_r_start_date != null">
					AND <![CDATA[ VT_R_START_DATE >= #{vt_r_start_date} ]]>
				</if>
				<if test="vt_r_end_date != null">
					AND <![CDATA[VT_R_END_DATE <= #{vt_r_end_date} ]]>
				</if>
				<if test="vt_a_start_date != null">
					 AND <![CDATA[VT_A_START_DATE >= #{vt_a_start_date} ]]>
				</if>
				<if test="vt_a_end_date != null">
					 AND <![CDATA[ VT_A_END_DATE <= #{vt_a_end_date} ]]>
				</if>
			</if> 
			<if test="vt_name != null">
					 AND <![CDATA[ VT_NAME LIKE '%'||#{vt_name}||'%' ]]>
			</if>
		</where>
	</select>

	<select id="selectRcByVt_no" resultType="recruit" parameterType="int">
		SELECT VT_NO,VT_NAME, VT_O_NO,O_ONAME,
		VT_R_START_DATE,
		VT_R_END_DATE,VT_R_YN,
		VT_A_START_DATE,VT_A_END_DATE, VT_CLASS, VT_TOT,
		VT_SUBJECT,
		VT_SUBJECT,VT_DESC,
		SUB_NAME,CLASS_NAME,DCLASS_NAME FROM
		VT_RECRUIT A, DCLASS B, CLASS C,
		SUBJECT D, ORGAN E WHERE A.VT_CLASS =
		B.DCLASS_NO AND B.CLASS_NO =
		C.CLASS_NO AND A.VT_SUBJECT = D.SUB_NO AND
		A.VT_O_NO = E.O_NO AND
		VT_NO = #{vt_no}
	</select>

	<insert id="insertRc" parameterType="recruit">
		INSERT INTO VT_RECRUIT
		VALUES (NEW_VT_NO,
		#{vt_name},#{vt_o_no},SYSDATE,#{vt_r_end_date},'Y',#{vt_a_start_date},#{vt_a_end_date},#{vt_class},#{vt_tot},#{vt_subject},#{vt_desc})
	</insert>

	<update id="rcUpdate" parameterType="recruit">
		UPDATE VT_RECRUIT SET
		VT_NAME = #{vt_name}, VT_R_END_DATE = #{vt_r_end_date},
		VT_A_START_DATE = #{vt_a_start_date}, VT_A_END_DATE =
		#{vt_a_end_date}, VT_CLASS = #{vt_class}, VT_TOT = #{vt_tot},
		VT_SUBJECT = #{vt_subject}, VT_DESC = #{vt_desc} WHERE VT_NO =
		#{vt_no}
	</update>

</mapper>